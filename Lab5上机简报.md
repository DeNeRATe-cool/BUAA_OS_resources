# Lab5 exam / extra

> å¾€å¹´é¢˜æ•´ç†ï¼šå…¶å®æ²¡å•¥å‚è€ƒæ„ä¹‰ï¼Œæ¯å¹´éƒ½ä¸ä¸€æ ·ï¼Œé™¤äº† Exam å¯ä»¥ç¨å¾®æ¸©æŸ”ä¸€ç‚¹ä¹‹å¤–ï¼ŒExtra çœŸçš„æ˜¯ç»™äººå¹²è’™åœˆäº†
>
> å¾€å¹´é¢˜æ•´ç†å¦‚ä¸‹ï¼š
>
> - [2023-1-exam](https://cookedbear.top/p/36639.html)
>
> å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œæ¥è®¿é—®å¤–è®¾æ—¶é’Ÿ
>
> åŒæ ·æ˜¯ä½¿ç”¨ `syscall_read_dev() & syscall_write_dev()`
>
> - [2023-2-exam](https://cookedbear.top/p/48159.html)
>
> ä¸€ä¸ªç”¨æˆ·æ¥å£ï¼Œå®ç°é€šè¿‡ç›¸å¯¹è·¯å¾„æ‰“å¼€æ–‡ä»¶
>
> - [2024-exam](https://github.com/gitDebuger/2024-os-lab/blob/documents/lab5.md)
>
> å®ç°é€’å½’å¤åˆ¶ç›®å½•åˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„å‡½æ•°

è¿™æ¬¡çš„ä¸Šæœºè¯´å®è¯ï¼Œå±äºæ˜¯åŠ©æ•™è‡ªå·±ç©å—¨äº†ï¼Œæ†‹ä¸€ç‚®å¤§çš„ï¼Œè®©å¤§å®¶é€Ÿé€Ÿæ¥å°ä¸€å°å’¸æ·¡ï¼Œè¿™æ¬¡ä¸å‡ºæ„å¤–ï¼Œåº”è¯¥æ²¡æœ‰è¶…è¿‡ 5 ä¸ªäººæå®šäº†ï¼Œå…¶å® u1s1ï¼Œæˆ‘è®¤è¯†çš„ä½¬é‡Œè¾¹æ˜¯çœŸæ²¡æœ‰åšå‡ºæ¥çš„â˜ºï¸

æ¥ä¸‹æ¥æˆ‘å°å°åæ§½ä¸€æ³¢ï¼ˆå±äºæ˜¯ä¸ªäººè¾“å‡ºï¼Œæƒ³çœ‹é¢˜ç›®çš„ç›´æ¥ç•¥è¿‡å°±è¡Œå˜»å˜»å˜»ğŸ˜‹ï¼‰ï¼šä¸Šæœºçš„å‰ä¸¤å¤©ï¼Œå„ä¸ªæ¸ é“åŠ èµ·æ¥å‘äº†ä¸ä¸‹ 5 æ¬¡

> @æ‰€æœ‰äººâ€…ä»Šå¤©ä¸Šæœºä¸ºé¼“åŠ±å¤§å®¶æå‡å®éªŒæˆç»©ï¼Œè¯¾ç¨‹ç»„å¯¹è¯„åˆ†æ ‡å‡†è¿›è¡Œäº†æ”¹åŠ¨:
>
> 1. Lab5 Extra åˆ†å€¼ç”±åŸæ¥çš„ 1åˆ†æå‡ä¸º 2åˆ†
>
> 2. Lab5 Exam ï¼Œå¢åŠ äº†æµ‹è¯•ç‚¹ï¼ŒåŒå­¦ä»¬åªè¦æäº¤å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ä»£ç å³å¯è·å¾—50% çš„åˆ†æ•°

å±äºæ˜¯çœ‹èµ·æ¥å¸Œæœ›å¤§å®¶éƒ½è¿‡æ¥åšé¢˜ï¼Œéšä¾¿æ‹¿åˆ†ï¼Œç»“æœæ˜¯å‡ºäº†ä¸€é“æå…¶æ¶å¿ƒçš„é¢˜ç›®å¸Œæœ›å¤§å®¶éƒ½æ¥åƒåƒå¥¥é‡Œç»™ğŸ˜€ï¼Œé¢˜é‡å¤§å¦‚ç‰›ï¼Œéš¾åº¦ä¸Šè¾¹ç¡®å®ä¹Ÿæ˜¯æ¯”è¾ƒå¤§

æˆ‘å‘¨å›´çš„ï¼Œå…¶å® exam ä¹Ÿæœ‰å¾ˆå¤šæ²¡æœ‰æ‹¿æ»¡çš„ä½¬ï¼Œå› æ­¤è¿™é“é¢˜ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œæˆ‘å’Œæ—è¾¹çš„å‘å·¨éƒ½æ˜¯åŠå°æ—¶è¿‡çš„ï¼Œç„¶åå°±æ˜¯é•¿è¾¾ 2h çš„åƒå¥¥é‡Œç»™ç¯èŠ‚äº†ï¼ˆæœ¬æ¥æ˜¯ 21 ç‚¹ä¸‹æœºï¼Œç„¶å 20ï¼š30 åŠ©æ•™è¿›æ¥è¯´å»¶æ—¶åŠå°æ—¶ï¼‰ã€‚è¿™é¢˜ç›®åšç€åšç€å°±æ„Ÿè§‰ä¸å¯¹åŠ²äº†ï¼Œæ€ä¹ˆè¿™ä¹ˆå¤šå‡½æ•°å‘€ï¼Œè°ƒç”¨æ¥è°ƒç”¨å»çš„ï¼Œè¿™åˆ°åº•å’‹ä¸ªå›äº‹å„¿å‘€ï¼Œæ¯ä¸ªå‡½æ•°è¿˜å†…å®¹æŒºå¤šã€‚ç„¶åæ¥è¿‘21ç‚¹æ‰ç¬¬ä¸€æ¬¡å…¨éƒ¨å†™å®Œï¼Œ21ï¼š10åˆ†å·¦å³ç¬¬ä¸€æ¬¡è°ƒé€šï¼Œç„¶åè·‘äº†ä¸€ä¸‹ï¼Œé”™äº†ï¼Œç„¶ååˆè°ƒï¼ŒåŠ å¯†å§‹ç»ˆåŠ ä¸ä¸Šï¼Œç„¶åäº¤äº†ä¸€å‘è¯æ˜æˆ‘è¿˜åœ¨åšæŒhhhï¼Œæœ€å 5 minï¼Œæœ€åä¸€å‘æ²¡è¿‡ä¹‹åå°±å’Œå‘å·¨å¼€å§‹å¯¹äºè¿™æ¬¡ä¸Šæœºçš„å‹å¥½äº¤æµäº†ï¼Œæˆ‘å˜ä¸ªéƒ½å‘€ï¼Œäººæ— å¥ˆçš„æ—¶å€™çœŸçš„ä¼šç¬‘

> è¿™é‡Œä½œä¸ºäº‹åè¯¸è‘›ï¼Œç»™çœ‹åˆ°è¿™ç¯‡ç®€æŠ¥çš„åŒå¿—ä»¬è¯´ä¸€ä¸‹è¿™æ¬¡çš„ Lab5 ä¸Šæœºå¦‚ä½•å‡†å¤‡ï¼Œé¦–å…ˆè¦æ˜ç¡®è¿™æ¬¡çš„ä¸ŠæœºåŠ©æ•™å¤šåŠä¼šå‡ºå¾—æ¯”è¾ƒéš¾ï¼Œç»™å¤§å®¶ç•™ä¸€ä¸ªæ·±åˆ»çš„å°è±¡hhh
>
> éœ€è¦é‡ç‚¹ç†æ¸…æ¥šçš„å°±æ˜¯è¿›ç¨‹æƒ³è¦å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œéœ€è¦ç»è¿‡å“ªäº›å±‚æ¬¡ï¼Œæœ€å¥½å¯ä»¥ä»ç”¨æˆ·è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä¸€ç›´è¿½è¸ªåˆ°å‘ç£ç›˜é‡Œè¾¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®é‚£ä¸ªåœ°æ–¹ï¼Œç†æ¸…è¿™é‡Œè¾¹çš„æ‰€æœ‰**å‚æ•°ä¼ é€’æ–¹å¼ã€æ•°æ®ç»“æ„ã€çŠ¶æ€è½¬ç§»ã€å‡½æ•°è°ƒç”¨æ–¹å¼**ï¼Œå› ä¸º extra çœŸçš„ä¼šå°†æ–‡ä»¶ç³»ç»Ÿä»é¡¶å±‚åˆ°è®¾å¤‡å…¨éƒ¨æ‹‰é€šï¼Œä¹Ÿç®—æ˜¯å¯¹äºæ“ä½œç³»ç»Ÿçš„ä¸€æ¬¡æ•´ä½“ç†è§£å’Œè¿ç”¨äº†ï¼ŒåŠ æ²¹ï¼ï¼ï¼

### Exam

- ç»™å®šä¸€ä¸ªç»å¯¹è·¯å¾„ä»¥åŠä¸€ä¸ªæ–‡ä»¶åï¼Œä¿è¯å¯»è·¯ç»ˆç‚¹ä¸€å®šæ˜¯ä¸€ä¸ªç›®å½•ï¼Œé€’å½’éå†è¿™ä¸ªç›®å½•é‡Œè¾¹çš„æ‰€æœ‰æ–‡ä»¶åŠç›®å½•ï¼Œå¯¹äºåå­—ç›¸åŒçš„å…¨éƒ¨åŠ å…¥ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­è¿›è¡Œä¿å­˜

è¿˜æ˜¯æ¯”è¾ƒèƒ½æ‘¸æ¸…æ€è·¯çš„ï¼Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯ `walk_path()` å‡½æ•°çš„è°ƒç”¨ï¼Œç¬¬äºŒç‚¹å°±æ˜¯é€’å½’å®ç°æ–‡ä»¶éå†åŒæ—¶ç»´æŠ¤å¥½è·¯å¾„é•¿åº¦ã€‚

å¦å¤–é¢˜ç›®æœ‰è¦æ±‚åˆ¤æ–­ä¸€äº›æŠ¥é”™ï¼Œæ¯”å¦‚å¦‚æœæœ€å¼€å§‹ç»™å‡ºçš„è¿™ä¸ª `path` é•¿åº¦å°±è¿èƒŒçº¦æŸäº†ï¼Œé‚£ä¹ˆç›´æ¥æŠ¥é”™ï¼Œå¦‚æœåœ¨DFSè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜é‚£ä¹ˆç›´æ¥ `continue` å³å¯

ä¸€ä½åŒå­¦å¡åœ¨äº†å¤„ç†å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç³»ç»Ÿåªæ”¯æŒ `strcpy`ï¼Œä¸æ”¯æŒ `strcat`ï¼Œå› æ­¤è·¯å¾„å»¶å±•çš„æ—¶å€™æœ€å¥½æ˜¯ç›´æ¥ä½¿ç”¨ for å¾ªç¯è¿›è¡Œæ·»åŠ ï¼Œä¸€äº›ç»†èŠ‚ä¹Ÿå¾—å¤„ç†ä¸€ä¸‹~~~

æˆ‘åœ¨å®ç°è¿‡ç¨‹ä¸­æ²¡æœ‰ä»€ä¹ˆç¢°å£ï¼Œä¸»è¦æ˜¯åœ¨OSä¸Šæœºè¿‡ç¨‹ä¸­ä¿æŒç†æ¸…æ€è·¯çš„çŠ¶æ€å°±è¡Œï¼Œè¯»æ¸…æ¥šæ¯ä¸ªé™åˆ¶å’Œæ¡ä»¶

**æ ¸å¿ƒä»£ç **

```c
int find_files(const char *path, const char *name, struct Find_res *res) {
        struct File *file;
        // ç”¨ walk_path æ¥æ‰¾åˆ° path å¯¹åº”çš„æ–‡ä»¶å¤¹
        // Lab5-Exam: Your code here. (1/2)
	if(strlen(path) == 0 || strlen(path) >= MAXPATHLEN)
		return -E_BAD_PATH; 
	if (walk_path((char *)path, 0, &file, 0) < 0) {
		return -E_NOT_FOUND;
	}
        // åœ¨ path å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹é¢éå†ï¼Œæ‰¾åˆ°æ‰€æœ‰åå­—ä¸º name çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥è°ƒç”¨ä¸‹é¢çš„å‚è€ƒå‡½æ•° traverse_file
        // Lab5-Exam: Your code here. (2/2)
	return traverse_file(path, file, name, res);
}

int traverse_file(const char *path, struct File *file, const char *name, struct Find_res *res) {
	u_int nblock;
	nblock = file->f_size / BLOCK_SIZE;

	// 1. æ£€æŸ¥è·¯å¾„é•¿åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå¦‚ä¸ç¬¦åˆï¼Œç›´æ¥è¿”å›
	if (strlen(path) == 0 || strlen(path) >= MAXPATHLEN) {
		return 0;
	}

	// 2. æ¯”è¾ƒå½“å‰æ–‡ä»¶åæ˜¯å¦ç­‰äº nameï¼Œå¦‚æœç›¸ç­‰åˆ™æ›´æ”¹ res
	if (strcmp(file->f_name, name) == 0) {
		// å¢åŠ res->count
		res->count++;
		// æ·»åŠ  res çš„è·¯å¾„
		strcpy(res->file_path[res->count - 1], path);
	}

	// å¦‚æœæ˜¯ç›®å½•,åˆ™é€’å½’æŸ¥æ‰¾
	if (file->f_type == FTYPE_DIR) {
		for (int i = 0; i < nblock; i++) {
			void *blk;
			try(file_get_block(file, i, &blk));
			struct File *files = (struct File *)blk;
			for (struct File *f = files; f < files + FILE2BLK; ++f) {
				char curpath[MAXPATHLEN + MAXNAMELEN + 1];
				// 3. æŠŠ path å’Œ name æ‹¼æ¥èµ·æ¥å¾—åˆ°ä¸‹ä¸€å±‚æ–‡ä»¶è·¯å¾„ï¼Œæ³¨æ„ç»“å°¾çš„'/'
				strcpy(curpath, path);
				int l = strlen(curpath);
				if (curpath[strlen(curpath) - 1] != '/') {
					curpath[l++] = '/';
				}
				for(int j = 0; j < strlen(f -> f_name); j++)
					curpath[l++] = f -> f_name[j];
				curpath[l] = '\0';
				// 4. é€’å½’è°ƒç”¨ traverse å‡½æ•°
				traverse_file(curpath, f, name, res);
			}
		}
	}
	return 0;
}

```

### Extra

å®ç°ä¸€ä¸ªå¼‚æˆ–åŠ å¯†æ–‡ä»¶çš„ç®—æ³•ï¼Œå…·ä½“éœ€è¦å®ç°ä»€ä¹ˆå‡½æ•°å’Œæµç¨‹å¯ä»¥çœ‹æˆ‘çš„ä»£ç ï¼Œåªèƒ½è¯´ä»£ç é‡å·¨å·¨$\cdots$å·¨å·¨å·¨å¤§ï¼ï¼ï¼

### å°¾è®°â€”â€”å°å½©è›‹

çŸ¥é“å½“æˆ‘åœ¨è€ƒè¯•è¿‡ç¨‹ä¸­åšå®Œ examï¼Œç„¶åè¦æ‰“å¼€ extra çš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªçš„æ˜¯æ—¶å€™æ˜¯å¦‚ä½•æ— å¥ˆåœ°ç¬‘çš„å—hhh

> æ­å–œä¸»æ’­è·å¾—å¼€é—¨ extra çº¢ + å…³é—¨ extra çº¢çš„æˆå°±~~~å˜»å˜»å˜»

![5ee12c79c9b48e4db30d0a404e03105](J:\TencentData\WeChat Files\wxid_j6c1rdn3ul0312\FileStorage\Temp\5ee12c79c9b48e4db30d0a404e03105.png)